
<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                layout:decorate="~{layout/baselayout}">

<th:block layout:fragment="css">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
</th:block>
<body>
  
<th:block layout:fragment = "content">    
  <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
    <h3 class="display-4" th:utext="${cat_name}"></h3>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-6">
        <img th:src="${'/product/image_display?dateFolderName=' + product.pro_up_folder + '&fileName=s_' + product.pro_img}" style="width: 100%;height: 255px;">
      </div>
      <div class="col-6">
        <form>
          <div class="form-group">
            <span id="info_pro_name" th:text="${product.pro_name}">이름</span>
            <small class="text-muted">(review : 0)</small>
          </div>
          <div class="form-group">
            <label for="exampleFormControlInput1">판매가격: </label><span th:text="${#numbers.formatInteger(product.pro_price, 3, 'COMMA') + '원'}"></span>
          </div>
          <div class="form-group">
            <label>수량</label>
            <input type="number" class="form-control" value="1" id="btn_cart_amount">
          </div>
          <div class="form-group">
            <button type="button" class="btn btn-secondary" style="width: 100%;" th:data-pro_num="${product.pro_num}" id="btn_direct_buy">BUY IT NOW</button>
            <button type="button" class="btn btn-light" style="width: 100%;" th:data-pro_num="${product.pro_num}" id="btn_cart_add">ADD TO CART</button>
          </div>
        </form>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <div id="pro_info">
          <ul>
            <li><a href="#tabs-1">상세정보</a></li>
            <li><a href="#tabs-2">상품리뷰(0)</a></li>
            <li><a href="#tabs-3">Q&A</a></li>
          </ul>
          <div id="pro_detail">
            <p th:utext="${product.pro_content}"></p>
          </div>
          <div id="pro_review">
            <p>M</p>
          </div>
          <div id="pro_qna">
            <p>M</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div>


  </div>

</th:block>
<th:block layout:fragment="script">
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.js"></script>
  <script>
    $(document).ready(function() {

      $( function() {
        $( "#pro_info" ).tabs();
      } );
      
      $("button#btn_cart_add").on("click", function() {

        console.log("장바구니 추가");

        let pro_num = $(this).data("pro_num");
        let cart_amount = $("#btn_cart_amount").val();

        $.ajax({
          url : '/cart/cart_add',
          type : 'get',
          data : {pro_num : pro_num, cart_amount : cart_amount},
          dataType : 'text', // success 문자열만 받아올 예정
          success : function(result) {
            if(result == 'success') {
              alert("상품이 장바구니에 담겼습니다.");
              if(confirm("장바구니로 이동하시겠습니까?")) {
                location.href = "/cart/cart_list";
              }
            }
          }
        });
      });

      // 바로구매
      $("button[name='btn_direct_order']").on("click", function() {
        $('#order_process_popup_2').modal('show'); // bootstrap4에서 제공해주는 명령어

        let pro_num = $(this).data("pro_num");
        console.log("상품코드", pro_num);

        $("#popup_info").load("/product/pro_info_2?pro_num=" + pro_num);
      });


    }); // ready end
  </script>
</th:block>
</body>
</html>